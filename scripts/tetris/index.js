"use strict";function _defineProperty(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}!function(){var o=document.getElementById("pw_submit"),r=document.getElementById("new_score_2").firstElementChild;window.firebase&&firebase.firestore().collection("tetris").doc("scores").onSnapshot(function(e){if(e.metadata.fromCache&&!e.exists)return document.body.classList.add("no_scores"),document.body.classList.add("scores_err"),void(document.getElementById("scores_msg").firstElementChild.innerText="Connect to the Internet to see scores.");document.body.classList.remove("no_scores"),document.body.classList.remove("scores_err");var t=e.data(),n=t.p.map(function(e){return{owner:"p",value:e}}).concat(t.s.map(function(e){return{owner:"s",value:e}})).sort(function(e,t){return t.value-e.value});window.game=window.game||{updateScores:function(){}},game.scores=n,game.updateScores()}),document.getElementById("add_score").addEventListener("submit",function(e){e.preventDefault(),o.disabled||(o.disabled=!0,o.textContent="Sending Score...",auth.reauth(document.getElementById("pw").value).then(function(){for(var e={p:[],s:[]},t=0,n=game.scores.length;t<n;t++)e[game.scores[t].owner].push(game.scores[t].value);e[auth.userID]=e[auth.userID].sort(function(e,t){return t-e}),e[auth.userID].pop(),e[auth.userID].push(+document.body.getAttribute("data-score")),e[auth.userID]=e[auth.userID].sort(function(e,t){return t-e}),firebase.firestore().collection("tetris").doc("scores").update(_defineProperty({},auth.userID,e[auth.userID])).then(function(){document.body.classList.remove("new_score"),document.body.removeAttribute("data-score"),o.disabled=!1,o.textContent="Add Score",game.updateScores()}).catch(function(){r.innerText="There was a problem connecting to the Internet. Check your connection and try again.",o.disabled=!1,o.textContent="Add Score"})}).catch(function(e){"auth/wrong-password"==e.code?r.innerText="The password you entered is incorrect. Enter the correct password and try again.":"auth/network-request-failed"==e.code&&(r.innerText="There was a problem connecting to the Internet. Check your connection and try again."),o.disabled=!1,o.textContent="Add Score"}))}),document.getElementById("retry_scores").addEventListener("click",function(){firebase.firestore().collection("tetris").doc("scores").get({source:"server"}).then(function(e){var t;e.metadata.fromCache?document.body.classList.contains("no_scores")||(document.body.classList.add("scores_err"),scoresMsg.firstElementChild.innerText="These scores may not be up-to-date. Connect to the Internet to get updated scores."):(t=e.data(),game.scores=t.p.map(function(e){return{owner:"p",value:e}}).concat(t.s.map(function(e){return{owner:"s",value:e}})).sort(function(e,t){return t.value-e.value}),document.body.classList.remove("no_scores"),document.body.classList.remove("scores_err"))}).catch(function(){document.body.classList.contains("no_scores")||(document.body.classList.add("scores_err"),scoresMsg.firstElementChild.innerText="These scores may not be up-to-date. Connect to the Internet to get updated scores.")})})}();